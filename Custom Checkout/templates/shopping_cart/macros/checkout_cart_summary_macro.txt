<% registerMacro('checkoutCartSummary', function (options) { %>

<%
	var cart = options.cart
	,	summary = cart.get('summary')
	,	promocode = cart.get('promocode')
	,	item_count = _.reduce(cart.get('lines').pluck('quantity'), function (memo, quantity) { return memo + (parseFloat(quantity) || 1); }, 0)
	,	is_promocode_valid = promocode && promocode.isvalid
	,	giftcertificates = cart.get('paymentmethods').where({type: 'giftcertificate'}) || [];
	var sum = 0;
	var view = {};
	console.log(options);
%>
<style>
.cart-layover{
	position:absolute;
	left: 50%;
	top: 50%;
	margin-left: -484px;
	margin-top: -50px;
	width: 967px;
	background: white;
	-webkit-box-shadow: 10px 10px 10px #9E9E9E;
    -moz-box-shadow:    10px 10px 10px #9E9E9E;
    box-shadow:         10px 10px 10px #9E9E9E;
    z-index:999;
}
.close{
	
	font-size: 18px;
	line-height: 18px;
	color: rgba(255, 255, 255, 0.4);
	background: #f27337;
	position: relative;
	float: right;
	right: 10px;
	top: 10px;
	cursor: pointer;
}
</style>
<div class="cart-layover" style="display:none;">
<input type="button" class="close" value="X" onclick="jQuery('.cart-layover').hide()">
<h1 style="color: rgb(243, 122, 49); font-family: 'OmnesLightRegular'; font-size: 38px; font-weight: 400; width: 965px; margin-right: auto; margin-left: auto;">Cart</h1>
<% cart.get('lines').each(function (lines, index) { %>
			<%= SC.macros.shoppingCartItemLayover(lines, view, {
				showActions:true,
				application:options.application
			}) %>
		<% }) %>
</div>


<div class="checkout-cart-summary">
<div class="btncheckout-cart-summary-macro">
		<button class="bgbutton-checkout" data-action="submit-step">
			<%= options.continueButtonLabel %>
		</button>
</div><div style="background-color:#f87c00; margin-left:18px; margin-bottom: 11px">
	<header class="checkout-cart-summary-header">
		<% if (options.stepPosition.toLast > 0) { %>
			<a href="#" class="btn btn-link btn-edit-cart pull-right" onclick="jQuery('.cart-layover').show()" style="color:white;">
				<%= _('edit cart').translate() %>
			</a>
		<% } %>

		<h2 class="checkout-cart-summary-macro-title" style="color:white;">
			<%= _('Order Summary').translate() %>
		</h2>
	</header>
	<div class="dottedLine" style="color:white; margin-top:-10px; margin-bottom: 21px; text-align: center;">......................................</div>
	<div class="checkout-cart-summary-body">
		<%// if (!options.hideItems) { %>
		<ul class="cart-summary-items checkout-summary-items" style="display:none;">
		<%
			var thumbnail = ''
			,	item = null;
		%>
		<% cart.get('lines').each(function (line) { %>
			<%
				sum += line.get('total') - line.get('amount');
				item = line.get('item');
				thumbnail = item.get('_thumbnail');
			%>
			<li class="cart-summary-item-cell checkout-summary-item-cell">
				<div class="row-fluid" style="color:white;">
					<div class="span3 thumbnail checkout-summary-item-thumbnail">
						<img src="<%- options.application.resizeImage(thumbnail.url, 'tinythumb') %>" alt="<%- thumbnail.altimagetext %>">
					</div>
					<div class="span9 cart-summary-item-details checkout-summary-item-details" style="color:white;">
						<div class="pull-right cart-summary-item-total">
							<%= line.get('total_formatted') %>
							<% if (line.get('amount') > line.get('total')) {%>
								<small class="muted crossed cart-summary-item-amount">
									<%=  line.get('amount_formatted') %>
								</small>
							<% } %>
						</div>
						<div style="color:white;">
							<strong class="cart-summary-item-name"><%= item.get('_name') %></strong>
						</div>
						<div class="cart-summary-item-quantity" style="color:white;">
							<%= _('Qty: $(0)').translate(line.get('quantity')) %>
						</div>
						<div class="cart-summary-item-price" style="color:white;">
							<%= SC.macros.showItemPrice(line.get('item')) %>
						</div>
						<%= /* Renders the selected options for the item */ 
							item.renderAllOptionSelected() %>
					</div>
				</div>
			</li>
		<% }) %>
		</ul>
		<%// } %>
		<div class="cart-summary-subtotal" style="color:white;">
			<p class="strong">
				<span class="pull-right cart-summary-subtotal-formatted">
					<%= summary.subtotal_formatted %>
				</span>
				<span class="cart-summary-subtotal-label">
					<%= _('Subtotal ($(0) $(1))').translate(item_count, item_count === 1 ? _('item').translate() : _('items').translate()) %>
				</span>
			</p>
		</div>

		

		<div class="cart-summary-shipping-cost-applied" style="color:white;">
			<% if(sum<0){ %>
			<p>
				<span class="pull-right cart-summary-shipping-cost-formatted">
					<%= sum.toFixed(2) %>
				</span>
				<%= promocode.code %>
			</p>
			<% } %>
			<p>
				<span class="pull-right cart-summary-shipping-cost-formatted">
					<%= summary.shippingcost_formatted == "$0.00" ? '-' : summary.shippingcost_formatted %>
				</span>
				<%= _('Shipping').translate() %>
			</p>

			<% if (summary.handlingcost) { %>
			<p>
				<span class="pull-right cart-summary-handling-cost-formatted">
					<%= summary.handlingcost_formatted %>
				</span>
				<%= _('Handling').translate() %>
			</p>
			<% } %>
			<p>
				<span class="pull-right cart-summary-tax-total-formatted">
					<%= summary.taxtotal_formatted=="$0.00" ? '-' : summary.taxtotal_formatted %>
				</span>
				<%= _('Tax').translate() %>
			</p>
		</div></div>

		<% if (is_promocode_valid || summary.giftcertapplied) { %>
			<% if (is_promocode_valid && summary.discounttotal) { %>
			<div class="cart-summary-promocode-applied" style="color:white">
				<p>
					<strong class="lead-price pull-right">
						-<%= summary.discounttotal_formatted %>
					</strong>
					<%= _('Promo Code').translate() %> #<%= promocode.code %>
										<% if (options.stepPosition.toLast > 0) { %>
					<!--	<a href="#" data-action="remove-promocode">
							<i class="icon-remove"></i>
						</a>	-->
					<% } %>
				</p>
			</div>
			<% } %>
			
			<% if (summary.giftcertapplied) { %>
			<div class="cart-summary-giftcertificate-applied">
				<p>
					<%= _('Gift Certificates Applied ($(0))').translate(giftcertificates.length) %>
				</p>
				<% _.each(giftcertificates, function (giftCertificate) { %>
					<p>
						<span class="pull-right">
							<%= _('-$(0)').translate(giftCertificate.get('giftcertificate').amountapplied_formatted) %>
						</span>
						<span title="<%- giftCertificate.get('giftcertificate').code %>">
							<%= SC.macros.formatPaymentMethod(giftCertificate) %>
						</span>
					</p>
				<% }); %>
				</div>
			<% } %>
		<% } %>
		<div class="checkout-cart-summary-macro-total" style="background-color:#f5631a; color: white;">
			<p class="strong">
				<span class="pull-right cart-summary-total-formatted">
					<%= summary.total_formatted %>
				</span>
				<%= _('Total').translate() %>
			</p>
		</div>
<!--
	<% if (options.stepPosition.toLast === 1) { %>
		<div>
		<% if (SC.ENVIRONMENT.siteSettings.checkout.requiretermsandconditions === 'T') { %>
			<p><%= _('By placing your order, you are agree to our <a data-toggle="show-terms-summary" href="#">Terms & Conditions</a>').translate() %></p><br/>
		<% } %>
			<button class="btn btn-primary btn-large btn-place-order" data-action="submit-step">
				<%= options.continueButtonLabel %>
			</button>
		</div>
	<% } %>
-->


	</div>

	<% if (!is_promocode_valid && options.stepPosition.toLast > 0) { %>
	<footer class="checkout-cart-summary-footer accordion">
		<div >

			<p class="checkout-cart-summary-macro-promo-title"><%= _('Have a Promo Code?').translate() %></p>
			<div id="promo-code-container" >
			<p>Enter your promotional code or coupon code below. Limit one per order please.</p>
				<%= SC.macros.promocodeForm(promocode) %>
			</div>
		</div>
	</footer>
	<% } %>
	
	
	
		<% if (is_promocode_valid && options.stepPosition.toLast > 0) { %>
	<footer class="checkout-cart-summary-footer accordion">
		<div class="promoCode">							

			<p class="checkout-cart-summary-macro-promo-title"><%= _('Have a Promo Code?').translate() %></p>

			<p>Enter your promotional code or coupon code below. Limit one per order please.</p>
			
			<div class="control-group">
			<input
				type="text"
				class="input-medium promocode"
				value="<%= promocode.code %>"
				readonly
style="width: 90px;"

			>
			<button data-action="remove-promocode" class="bgbutton-checkout-apply">
				<%= _('Remove').translate() %>
			</button>
			</div>
			
		</div>
	</footer>
	<% } %>




<div class="btncheckout-cart-summary-macro">
		<button class="bgbutton-checkout" data-action="submit-step">
			<%= options.continueButtonLabel %>
		</button>
		<!--<input type="image" src="http://www.paypal.com/en_US/i/btn/btn_xpressCheckoutsm.gif" 
		onclick="window.location='<%=options.payPalUrl%>'"
		class="nlbutton" style="background: #FFF;border: 0px solid #fff;">-->
</div>
</div>
<% }) %>

