<script type="text/javascript" src="/SSP Applications/Poppin/SocialMediaLogin/easyXDM.js"></script>
<script type="text/javascript" src="/SSP Applications/Poppin/SocialMediaLogin2/js/jquery.powertip.js"></script>
<link href="/site/social-login/css/login.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
if(window.location.href.indexOf('checkout.sandbox.netsuite.com')<0){
  var socket = new easyXDM.Socket({
	remote:poppinres.url.miniloginpage,
	onMessage:function(message,origin)
	{
		document.body.style.cursor = 'default';
		if(message==null){
			jQuery("#dialogresponse").html(poppinres.text.responseobjectnull);
			jQuery("#dialogresponse").dialog({title:"Info"});
		};
		var responseObject = JSON.parse(message);
		console.log(responseObject);
		if(responseObject.responsetype==null){
			jQuery("#dialogresponse").html(poppinres.text.responsetypenull);
			jQuery("#dialogresponse").dialog({title:"Info"});
			return;
		};
		switch(responseObject.responsetype){
			case 'success':
				jQuery("#dialogresponse").html(responseObject.message);
				jQuery("#dialogresponse").dialog({title:"Info"});
				break
			case 'linksocial':
				window.location=poppinres.url.loginpage+ "?linksocial=T&"+jQuery.param(responseObject.message);
				break
			case 'redirect':
				var loginUser = {"remember":document.forms['miniloginform'].elements['remember'].checked,
					"email":document.forms['miniloginform'].elements['email'].value,
					"password":document.forms['miniloginform'].elements['password'].value
				};
				if(document.forms['miniloginform'].elements['remember'].checked){
					storeLoginCookie(loginUser);
				}else{
					resetLoginCookie();
				}
				if(responseObject.socializenotify!=undefined){
					var notifyobject = responseObject.socializenotify;
					if(notifyobject.type=='login'){
						gigya.socialize.notifyLogin(notifyobject.params);
					} else if (notifyobject.type=='register'){
						gigya.socialize.notifyRegistration(notifyobject.params);
					};
				};
				window.location = responseObject.message;
				break
			case 'error':
				var errormessage = responseObject.message;
				errormessage = errormessage.substring(errormessage.lastIndexOf(":")+1,errormessage.length);
				jQuery("#dialogresponse").html(errormessage);
				jQuery("#dialogresponse").dialog({title:"Info"});
				return false;
				break
			default:
				jQuery("#dialogresponse").html(poppinres.text.responsetypeunknown);
				jQuery("#dialogresponse").dialog({title:"Info"});
				return false;
		};
	}
  });
}

function miniForgotPassword(){
	var user = {
		"requesttype" : "forgotpassword",
		"email" : document.forms['miniloginform'].elements['email'].value,
		"password" : document.forms['miniloginform'].elements['password'].value
	};
	if (user.email === ''){
		showTipEmail('<p>'+poppinres.text.emailempty+'</p>');
		return false;
	}
	if (!validateEmail(user.email)){
		showTipEmail('<p>'+poppinres.text.emailinvalid+'</p>');
		return false;
	}
	var userstr = JSON.stringify(user);
	socket.postMessage(userstr);
}
function showTipEmail(error_msg){
	powerTip.create('miniemail', '<p>'+error_msg+'</p>', 'powerTipminiemail', -69, 20);
	$('#miniemail').on('focusin', function() { powerTip.hide('powerTipminiemail'); });
	$('#miniemail').attr('class','input-red');
}
function showTipPwd(error_msg){
	powerTip.create('minipassword', '<p>'+error_msg+'</p>', 'powerTipminipassword', -69, 20);
	$('#minipassword').on('focusin', function() { powerTip.hide('powerTipminipassword'); });
	$('#minipassword').attr('class','input-red');
}
</script>