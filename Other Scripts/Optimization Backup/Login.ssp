<!doctype html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<%= getPageFullHead() %>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/jquery-ui-1.10.3.custom.min.js"></script>
<link rel="stylesheet" href="/SSP Applications/Poppin/SocialMediaLogin/smoothness/jquery-ui-1.10.3.custom.min.css" />

<link href="/site/social-login/css/login.css" rel="stylesheet" type="text/css" />
<style>
.phoneDiv span a{
color: #969696;
}

.breadcrumbs{
visibility:hidden;
}
#loginregisterbody #div__body{
position:relative;
padding-top: 30px;
}
iframe{
height:120px;
width:160px;
overflow:hidden;
}
div.free-shipping-container{
display:none;
}

</style>
<script language="javascript">


function getQuerystring(key, default_)
{
	if (default_==null) default_=""; 
	key = key.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
	var regex = new RegExp("[\\?&]"+key+"=([^&#]*)");
	var qs = regex.exec(window.location.href);
	if(qs == null)
	return default_;
	else
	return qs[1];
}

/* get Lead Source functions */
function getCommentsFromEl(el, asArray) {
	var result,
	$el = $(el).contents();
	result = $el.filter(function () {
			return this.nodeType == 8;
		});
	if (asArray) {
		result = $.makeArray(result.map(function () {
			return this.nodeValue;
		}));
	}
	return result;
};
$.fn.getComments = function (asArray) {
	return getCommentsFromEl(this, asArray);
};
function getLeadSource() {
	
	var comments = $("head").getComments(),
		i = comments.length,
		g = '', comment, ls = {};
	
	while(i !== 0) {
		i--;
		comment = comments[i].data;
		if(comment.search("leadsource") !== -1) {
			g = comment;
			break;
		}
	}
	
	var f = g.indexOf("leadsource=")+11;
	var s = g.substring(f, g.indexOf("=", f)).lastIndexOf(" ");
	var result = g.substring(f, f+s).trim();
	
	if(g != '') {
		return result;
	} else {
		return '';
	}
};

/* end of get Lead Source functions */

jQuery(document).ready(function(){
	jQuery('#companyhelp').on('mouseenter', function(){
		powerTip.create('company', jQuery('#whatthisfortext').html(), 'powerTipCompany', -15, 176);
	});
	jQuery('#companyhelp').on('mouseleave',function(){powerTip.hide('powerTipCompany');});
	jQuery('#leadsource').val(getLeadSource());
});

var checkout = false;
if(window.location.href.indexOf('checkout=T')>-1)
	{
		checkout = true;
	}
$(function(){
	if(getQuerystring('linksocial')=='T'){
		//store link social data in form
		document.forms['link-social'].elements['emaillink'].value = decodeURIComponent(getQuerystring('email'));
		document.forms['link-social'].elements['timestamp'].value = decodeURIComponent(getQuerystring('timestamp'));
		document.forms['link-social'].elements['signature'].value = decodeURIComponent(getQuerystring('signature'));
		switchview('linksocial');
	}
})

$(function() { 
	$('#loginform').on('submit', function(e) { 
		e.preventDefault();  
		loginformSubmitUser();
	});
	$('#twitter-email').on('submit', function(e) { 
		e.preventDefault();  
		loginTwitter();
	});  
	$('#link-social').on('submit', function(e) { 
		e.preventDefault();  
		linkSocialAccount();
	});
	$('#new-customer-register').on('submit', function(e) { 
		e.preventDefault();  
		registerformSubmitUser();
	});
	
	$('form#new-customer-register > fieldset > input#business').on('click', function(e) {
		var display = $(this).is(':checked') ? 'block' : 'none';
		$('form#new-customer-register > fieldset#fs_company').css('display', display);
	});
});
function switchview(viewtype)
{
	switch(viewtype){
	case 'login':
		$('.login-case-block').css('display', 'block');
		$('#twitter-email').css('display', 'none');
		$('#link-social').css('display', 'none');
		break
	case 'register':
		$('.login-case-block').css('display', 'none');
		$('#twitter-email').css('display', 'none');
		$('#link-social').css('display', 'none');
		break
	case 'twitteremail':
		$('.login-case-block').css('display', 'none');
		$('#twitter-email').css('display', 'block');
		$('#link-social').css('display', 'none');
		break
	case 'linksocial':
		$('.login-case-block').css('display', 'none');
		$('#twitter-email').css('display', 'none');
		$('#link-social').css('display', 'block');
		break
		
	default:
		jQuery("#dialogresponse").html('Unknown view type');
		jQuery("#dialogresponse").dialog({ title: "Info" });
	}
}
</script>
<script language="javascript">

var socket = new easyXDM.Socket({
	remote: poppinres.url.gigyacontrol,
	container: "iframecontainer",
	onMessage:function(message, origin) {
		var deserialized = JSON.parse(message);
		if(deserialized.provider==='twitter') {
				document.forms['twitter-email'].elements['customername'].value = deserialized['user'].firstName +' ' +deserialized['user'].lastName;
				document.forms['twitter-email'].elements['timestamp'].value = deserialized.signatureTimestamp;
				document.forms['twitter-email'].elements['UID'].value = deserialized.UID;
				document.forms['twitter-email'].elements['signature'].value = deserialized.UIDSignature;
				switchview('twitteremail');
			}
		else {
				socialLogin(deserialized);
			}
	}
});
function socialLogin(deserialized)
{
	var newUser = {
			"requesttype":"sociallogin",
			"remember":true,
			"email":deserialized['user'].email,
			"name":deserialized['user'].firstName +' ' +deserialized['user'].lastName,
			"password":'',
			"password2":'',
			"checkout":checkout,
			"timestamp":deserialized.signatureTimestamp,
			"UID":deserialized.UID,
			"signature":deserialized.UIDSignature
			};
	sendLoginRequest(newUser);
}
function loginformSubmitUser()
{
	var loginUser = {
			"requesttype":"login",
			"remember":document.forms['loginform'].elements['remember'].checked,
			"email":document.forms['loginform'].elements['emaillog'].value,
			"password":document.forms['loginform'].elements['password'].value,
			"checkout":checkout
			};
	sendLoginRequest(loginUser);
}
function registerformSubmitUser()
{
	if(!validateRegisterForm()){return false;};
	
	var company = '';
	//if($('form#new-customer-register > fieldset > input#business').is(':checked')) {
		company = document.forms['new-customer-register'].elements['company'].value;
	//}
	var emailsubscribe = 'F';
	if($('form#new-customer-register > fieldset > input#subscribe').is(':checked')) {
		emailsubscribe = 'T';
	}
	
	var newUser = {
			"requesttype":"manualregister",
			"lead":document.forms['new-customer-register'].elements['leadsource'].value,
			"remember":true,
			"email":document.forms['new-customer-register'].elements['emailregnew'].value,
			"name":document.forms['new-customer-register'].elements['fname'].value + " " +document.forms['new-customer-register'].elements['lname'].value,
			"password":document.forms['new-customer-register'].elements['passwordnew'].value,
			"password2":document.forms['new-customer-register'].elements['passwordnew'].value,
			"company":company,
			"emailsubscribe":emailsubscribe,
			"checkout":checkout
			};
	sendLoginRequest(newUser);
}
function validateRegisterForm()
{
	var regEmail	= /^([0-9a-zA-Z_\\.-]+)@([\\da-zA-Z\\.-]+)\\.([a-zA-Z\\.]{2,6})$/;
	var regText		= /^[0-9a-zA-Z- ]{2,}$/;
	var regPass		= /^[0-9a-zA-Z]{6,}$/;
	
	var email		= $('form#new-customer-register > fieldset > div > input#emailregnew').first();
	var fname		= $('form#new-customer-register > fieldset > div > input#fname').first();
	var lname		= $('form#new-customer-register > fieldset > div > input#lname').first();
	var pass		= $('form#new-customer-register > fieldset > div > input#passwordnew').first();

	//remove unnecessary spaces before and after name values 
	$('form#new-customer-register > fieldset > div > input#fname').val($('form#new-customer-register > fieldset > div > input#fname').val().trim());
	$('form#new-customer-register > fieldset > div > input#lname').val($('form#new-customer-register > fieldset > div > input#lname').val().trim());

	$("#new-customer-register .input-red").removeClass("input-red");
	
	if(!regEmail.test(email.val()))
	{
		powerTip.create('emailregnew', poppinres.text.emailvalidation, 'powerTipEmail', -52, 123);
		$('#emailregnew').on('focusin', function() { powerTip.hide('powerTipEmail'); }) ;
		email.attr( "class", "input-red");
	}
	if(!regText.test(fname.val()))
	{
		powerTip.create('fname', poppinres.text.firstnamevalidation, 'powerTipFName', -52, 123);
		$('#fname').on('focusin', function() { powerTip.hide('powerTipFName'); }) ;
		fname.attr( "class", "input-red");
	}
	if(!regText.test(lname.val()))
	{
		powerTip.create('lname', poppinres.text.lastnamevalidation, 'powerTipLName', -52, 123);
		$('#lname').on('focusin', function() { powerTip.hide('powerTipLName'); }) ;
		lname.attr( "class", "input-red");
	}
	if(!regPass.test(pass.val()))
	{
		powerTip.create('passwordnew', poppinres.text.passwordvalidation, 'powerTipPass', -65, 123);
		$('#passwordnew').on('focusin', function() { powerTip.hide('powerTipPass'); }) ;
		pass.attr( "class", "input-red");
	}
	
	if($("form#new-customer-register input.input-red").size() > 0) {
		return false;
	} else {
		return true;
	}
}
function loginTwitter()
{
	if(!checkemailvalue(document.forms['twitter-email'].elements['emailtwitter'].value)){return false;};
	var newUser = {
			"requesttype":"sociallogin",
			"remember":true,
			"email":document.forms['twitter-email'].elements['emailtwitter'].value,
			"name":document.forms['twitter-email'].elements['customername'].value,
			"password":'',
			"password2":'',
			"checkout":checkout,
			"timestamp":document.forms['twitter-email'].elements['timestamp'].value,
			"UID":document.forms['twitter-email'].elements['UID'].value,
			"signature":document.forms['twitter-email'].elements['signature'].value
	}
	sendLoginRequest(newUser);
}
function linkSocialAccount()
{
	var newUser = {
			"requesttype":"sociallink",
			"remember":true,
			"email":document.forms['link-social'].elements['emaillink'].value,
			"password":document.forms['link-social'].elements['pwdlink'].value,
			"checkout":checkout,
			"timestamp":document.forms['link-social'].elements['timestamp'].value,
			"UID":document.forms['link-social'].elements['UID'].value,
			"signature":document.forms['link-social'].elements['signature'].value
	}
	sendLoginRequest(newUser);
}
function sendLoginRequest(user)
{
	$("#loginform .input-red").removeClass("input-red");
	powerTip.hide('powerTipEmaillog');
	powerTip.hide('powerTipPassword');
	
	if(typeof user.email ==='undefined' || user.email === '') {
		powerTip.create('emaillog', poppinres.text.emailempty, 'powerTipEmaillog', -37, 123);
		$('#emaillog').on('focusin', function() { powerTip.hide('powerTipEmaillog'); }) ;
		$('#emaillog').attr( "class", "input-red");
	}
	if( !validateEmail(user.email)) {
		powerTip.create('emaillog', poppinres.text.emailinvalid, 'powerTipEmaillog', -37, 123);
		$('#emaillog').on('focusin', function() { powerTip.hide('powerTipEmaillog'); }) ;
		$('#emaillog').attr( "class", "input-red");
	}
	if(user.requesttype ==='login' && user.password === '') {
		powerTip.create('password', poppinres.text.passwordempty, 'powerTipPassword', -37, 123);
		$('#password').on('focusin', function() { powerTip.hide('powerTipPassword'); }) ;
		$('#password').attr( "class", "input-red");
	}
	if($("#loginform .input-red").size() > 0) {
	return false;
	}
	if(user.remember){storeLoginCookie(user);}
	jQuery.ajax({
			url: poppinres.url.loginservice,
			data: user,
			dataType: 'jsonp',
			jsonp: 'json.wrf',
			success: response,
			error: response
		});
	
		//document.body.style.cursor = 'wait';
	jQuery('div#waitmask').show();
}

function response(data)
{
	//document.body.style.cursor = 'default';
	jQuery('div#waitmask').hide();
	var responseObject = JSON.parse(data.responseText);

	if(responseObject.responsetype==null){
		jQuery("#dialogresponse").html(poppinres.text.responsetypenull);
		jQuery("#dialogresponse").dialog({ title: "Info" });
		return;
	};
	switch(responseObject.responsetype)
	{
		case 'success':
			jQuery("#dialogresponse").html(responseObject.message);
			jQuery("#dialogresponse").dialog({ title: "Info" });
		break
		case 'linksocial':
			document.forms['link-social'].elements['emaillink'].value = responseObject.message.email;
			document.forms['link-social'].elements['timestamp'].value = responseObject.message.timestamp;
			document.forms['link-social'].elements['signature'].value = responseObject.message.signature;
			switchview('linksocial');
		break
		case 'redirect':
			if(responseObject.socializenotify!=undefined){
				var notifyString = JSON.stringify(responseObject.socializenotify);
				socket.postMessage(notifyString);
				}
			window.location = responseObject.message;	
			break
		case 'error':
			var errormessage = responseObject.message;
			errormessage = errormessage.substring(errormessage.lastIndexOf(":")+1,errormessage.length);

			if(errormessage.indexOf('password')!=-1){
				powerTip.create('password', errormessage, 'powerTipPassword', -51, 123);
				$('#password').on('focusin', function() { powerTip.hide('powerTipPassword'); }) ;
				$('#password').attr( "class", "input-red");
			} else if (errormessage.indexOf("haven't registered yet")!=-1) {
				powerTip.create('emaillog', errormessage, 'powerTipEmaillog', -51, 123);
				$('#emaillog').on('focusin', function() { powerTip.hide('powerTipEmaillog'); }) ;
				$('#emaillog').attr( "class", "input-red");
			} else if (errormessage.indexOf('user already exists')!=-1) {
				// registration form 
				powerTip.create('emailregnew', errormessage, 'powerTipEmail', -52, 123);
				$('#emailregnew').on('focusin', function() { powerTip.hide('powerTipEmail'); }) ;
				$('#emailregnew').attr( "class", "input-red");
			} else {
				// default errors message
				jQuery("#dialogresponse").html(errormessage);
				jQuery("#dialogresponse").dialog({ title: "Info" });
			}
			return false;
			break
		default:
			jQuery("#dialogresponse").html(poppinres.text.responsetypeunknown);
			jQuery("#dialogresponse").dialog({ title: "Info" });
			return false;	
		}
}
function forgotPasswordSocialLink()
{
	 var userforgotpassword = {
			 "requesttype":"forgotpassword",
			 "email":document.forms['link-social'].elements['emaillink'].value
			 }
	 sendLoginRequest(userforgotpassword);
}
</script>
</head>
<body id='loginregisterbody'>
<div id='outerwrapper' >
<div id='innerwrapper' >
<div id='div__header' class='noprint' leftmargin='0' topmargin='0' marginwidth='1' >
<div id='div__title' style='margin: 0px;'>
</div>
<div id='div__label' class='scrollarea' style='margin: 0px; overflow:hidden;'>
</div>
<table cellpadding="0" cellspacing="0" border="0" width="100%">
	<PP_LOGIN_PAGETOP>
</table>
<div class="promo-banner">
	<%=getRecordAttribute('199',1,'custrecord_bannerhtml')%>
</div>
</div>
<div id='div__body_outer' style="-webkit-box-shadow: -5px 5px 5px -2px rgba(139, 139, 139, 1);-moz-box-shadow: -5px 5px 5px -2px rgba(43,43,43,1);box-shadow: -5px 5px 5px -2px rgba(0, 0, 0, 0.4);">
<div id='div__body_inner'>
<div style="left: 100px;padding-bottom:0;padding-top: 30px;">
		<div class="login-login" >
			<form id="link-social" style="display:none; text-align:center;width:430px;margin:0 auto;">
				<input type="hidden" name="emaillink" value=""/>
				<input type="hidden" name="timestamp" value=""/>
				<input type="hidden" name="UID" value=""/>
				<input type="hidden" name="signature" value=""/>
				<h2 style="margin-bottom:40px;font-size: 15px;font-weight: bold;text-align: left;line-height: 20px;">Welcome back! Just go ahead and verify your poppin.com password below and let's be Best Friends Forever!</h2>
				<fieldset>
					<label for="Poppin password" style="display:block;">*Password</label>
					<input id="pwdlink" name="pwdlink" type="password" style="width:180px;"/>
					<div class="forgot-link"><a style="text-decoration:underline;margin:0;" href="#" onclick="forgotPasswordSocialLink();return false;">Forgot your password?</a></div>
				</fieldset>
				<fieldset>
							<input type="submit" name="linkaccounts" id="linkaccounts" value="Continue" class="orangeBtn" style="margin:0;"/>	
				</fieldset>	
			</form>
			<form id="twitter-email" style="display:none;">
				<input type="hidden" name="customername" value=""/>
				<input type="hidden" name="timestamp" value=""/>
				<input type="hidden" name="UID" value=""/>
				<input type="hidden" name="signature" value=""/>
				<fieldset>
					<label for="emailtwitter">Please provide your email address, unfortunately twitter service doesnt provide one.</label>
					<input id="emailtwitter" name="emailtwitter" type="text" style="width:300px;margin-top:15px;" />
				</fieldset>
				<fieldset>
							<input type="submit" name="register" id="register" value="Continue" class="orangeBtn" style="margin:0;"/>	
							<a href="#" onclick="switchview('login');">Go back</a>	
				</fieldset>
			</form>
			<div class="login-case-block">
				<div class="social" style="width: 190px;display:none;">
					<h3>LOGIN WITH SOCIAL</h3>
					<div id="iframecontainer"></div>
					<div class="required" style="position: absolute; padding-left: 13px;">**All fields are required</div>
				</div>
				<div class="verticalHr" style="display:none;">
					<div class="hr"></div>
					or
					<div class="hrlong"></div>
				</div>
				<div class="returning">
					<h3>RETURNING CUSTOMERS</h3>
					<form id="loginform" action="LoginService.ss">
						<fieldset style="display:none;">
						<input type="hidden" name="checkout" value=""/>
						<input type='hidden' name='viewHint' value='F'/>
						<input type='hidden' name='forgotPasswd' value='F'/>
						</fieldset>
						<fieldset>
							<label for="email">Email</label>
							<div style="position: relative;"><input id="emaillog" name="email" type="text" onchange="resetLoginCookie();"/></div>
						</fieldset>
						<fieldset>
							<label for="pass">Password</label>
							<div style="position: relative;"><input id="password" name="password" type="password"/></div>
						</fieldset>
						<fieldset>
							<div class="forgot-link"><a style="text-decoration:underline;margin:0;" href="#" onclick="forgotPasswordOld();return false;">Forgot password?</a></div>
							<input type="submit" value="continue" class="orangeBtn" name="login" id="login" style="font-family: 'arial'; float: left;border-width: 1px; border-style: solid; background: linear-gradient( -90deg, #c9dd1a, #b6d00d); background: -webkit-linear-gradient( -90deg, #c9dd1a, #b6d00d); -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); width: 180px; height: 25px; font-size: 15px; border-radius: 8px;" />
						</fieldset>
						<fieldset>
							<input id="remember" name="remember" type="checkbox"checked /><label class="checkLbl" for="pass">Remember Me</label>
						</fieldset>
						<!--<fieldset>
						 <div class="socialremindercontainer">
							<div class="socialreminder">If you previously logged in with a social media account, just enter the email + password associated with that account above. <div class="socialarrow" ></div></div>
						</div> 
						<div class="sociallogos" style="width:161px;height:24px;"></div>
						<div data-id="54cb7e021f" class="livechat_button"><a href="http://www.livechatinc.com/"><div class="chathelp"><div class="chatimg"></div>Need help? Chat now</div></a></div> 
						</fieldset>-->
					</form>
				</div>
				<div class="verticalHr">
					<div class="hr"></div>
					or
					<div class="hrlong"></div>
				</div>
				<div class="new-customer">
					<h3>NEW CUSTOMERS</h3>
					<form id="new-customer-register" action="LoginService.ss">
						<fieldset>
							<label for="fname">First Name</label>
							<div style="position: relative;"><input id="fname" name="fname" type="text"/></div>
						</fieldset>
						<fieldset>
							<label for="lname">Last Name</label>
							<div style="position: relative;"><input id="lname" name="lname" type="text"/></div>
						</fieldset>
						<fieldset style="display: none;">
							<input id="leadsource" name="leadsource" type="text"/>
						</fieldset>
						<fieldset>
							<label for="email">Email</label>
							<div style="position: relative;"><input id="emailregnew" name="email" type="text" /></div>
						</fieldset>
						<fieldset>
							<label for="password">Create Password</label>
							<div style="position: relative;"><input id="passwordnew" name="password" type="password"/></div>
						</fieldset>
						<fieldset id="fs_company" style="width: 300px;position:relative;">
							<label for="company">Company Name</label>
							 <input id="company" name="company" placeholder="(Optional)" type="text" style="width: 197px;"/>
							 <span title="Enter company name here" style="cursor: pointer; font-size: 13px;" id="companyhelp"><img style="margin-bottom:-10px; margin-left:5px;" src="/site/social-login/css/images/whatsthis.jpg"/></span>
							 <div name="whatthisfortext" id="whatthisfortext" style="display: none;"><p> <PP_LOGIN_WHATTHISFOR_TEXT> </p></div>
						</fieldset>
						<fieldset>
							<input type="submit" value="Continue" class="orangeBtn" name="submit" id="submit" style="font-family: 'arial'; margin: 0px; border-width: 1px; border-style: solid; background: linear-gradient( -90deg, #c9dd1a, #b6d00d); background: -webkit-linear-gradient( -90deg, #c9dd1a, #b6d00d); -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); width: 180px; height: 25px; font-size: 15px; border-radius: 8px;"/>
						</fieldset>
						<fieldset style="width: 260px;">
							<input id="subscribe" name="subscribe" type="checkbox" checked style="margin-top:3px;"/>
							<label class="checkLbl" style="float: right;margin-right: 7px;">Sign up for Poppin Email!<br/>(Joining the Work Happy Revolution)</label>
						</fieldset>
						  <!-- <fieldset>
							<input id="business" name="business" type="checkbox" />
							<label class="checkLbl">I'm a business customer</label>
						</fieldset>
						<fieldset id="fs_company" style="display: none;">
							<label for="company" style="margin-bottom: 10px; display: block;">Company Name<i>(optional)</i></label>
							<input id="company" name="company" type="text"/>
						</fieldset>-->
					</form>
				</div>
			</div>
</div>
</div>
</div>
</div>
<div id="empty" style="height: 120px;"></div>
</div>

<div id='div__footer' class='noprint' leftmargin='0' topmargin='0' marginwidth='1' marginheight='1'>
<PP_FOOTER>
<!-- ERP Guru NetSuite Display Override-->
<script type="text/javascript">
	function egHtmlDecode(input){
		var e = document.createElement('div');
		e.innerHTML = input;
		return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
	}
	$j(document).ready(function(){
	//remove quick view
		//many
		$j("#handle_portlet_-521").closest("td").remove();

		//modify url of see return requests
		$j('a[href*="/app/accounting/transactions/rtnauth.nl?ck="]').attr("href","");

		//replace link string in saved search by actual link
		$j('td.listtexthl:contains("<a href=")').each(function(index,element){
			var linkObject = $j(this).html().replace(/&lt;/gi,"<").replace(/&gt;/gi,">");

			$j(this).html(egHtmlDecode(linkObject));
		});
	});
</script>
<!-- END ERP Guru NetSuite Display Override-->
<GA_FUNNELS>
<SMARTYSTREETS>
<CARD_SELECTOR_EMPTY>
</div>
</body>
</html>